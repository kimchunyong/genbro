<?php

	include $_SERVER["DOCUMENT_ROOT"].'/include/head.php';
?>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!-- preloader area start -->
	<?php
		include $_SERVER["DOCUMENT_ROOT"].'/include/loader.php';
	?>
    <!-- preloader area end -->
    <!-- page container area start -->
    <div class="page-container">
        <!-- sidebar menu area start -->
        <?php
			include $_SERVER["DOCUMENT_ROOT"].'/include/menu.php';
		?>
        <!-- sidebar menu area end -->
        <!-- main content area start -->
        <div class="main-content">
            <!-- header area start -->
            <?php
				include $_SERVER["DOCUMENT_ROOT"].'/include/head_nav.php';
			?>
            <!-- header area end -->
            <!-- main content area start -->
            <div class="main-content-inner">
				<!-- 기관관리 table s -->
				<div class="col-12 mt-5">
					<div class="card">
						<div class="card-body">
							<!-- chosen plugin s -->
							<div class="input-group mb-3">
								<div class="search select px-0">
									<select data-placeholder="검색어를 입력해 주세요">
										<option vlaue=""></option>
										<option>검색어</option>
										<option>검색어1</option>
									</select>
								</div>
								<div class="input-group-append">
									<input class="btn btn-flat btn-secondary mb-3" type="submit" value="검색">
								</div>
								<div class="refresh_btn_box">
									<button type="button" class="btn mb-3  justify-content-end">
										<i class="fa fa-refresh" data-perform="panel-refresh"></i>
									</button>
								</div>
							</div>
							<!-- chosen plugin e -->
							<div class="single-table" id="view">
								<div class="table-responsive">
									<table class="table table-row progress-table text-center table-990 odd-table">
										<thead class="text-uppercase bg-dark">
											<tr class="text-white">
												<th scope="col">순서</th>
												<th scope="col">GC P ID</th>
												<th scope="col">GC S ID</th>
												<th scope="col">중간 관리자</th>
												<th scope="col">검사실 책임자</th>
											</tr>
										</thead>
										<tbody id="list" data-zone="view.content">
											<!-- item01 s -->
											<!--tr>
												<td>1</td>
												<td>홍길동</td>
												<td>2018-09-13/05:23</td>	
												<td>
													<button type="button" class="btn btn-danger btn-xs" data-toggle="modal" data-target=".amd_log_popup">미확인</button>
													<!-- button type="button" class="btn btn-success btn-xs">확인</button -->
												<!--/td>
												<td>
													<button type="button" class="btn btn-danger btn-xs">미확인</button>
												</td>
											</tr-->
											<!-- item01 e -->
										</tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="999">
                                                    <div class="paging-box" data-zone="pagination"></div>
                                                </td>
                                            </tr>
                                        </tfoot>
									</table>
								</div>
							</div>
							<!-- 페이지버튼 s-->
							<!--nav>
								<ul class="pagination justify-content-center mt-5">
									<li class="page-item disabled">
										<a class="page-link" href="#" aria-label="Previous">
											<span aria-hidden="true">《</span>
											<span class="sr-only">first-page</span>
										</a>
									</li>
									<li class="page-item disabled">
										<a class="page-link" href="#" aria-label="Previous">
											<span aria-hidden="true">〈</span>
											<span class="sr-only">Previous</span>
										</a>
									</li>
									<li class="page-item active"><a class="page-link" href="#">1</a></li>
									<li class="page-item">
										<a class="page-link" href="#">2 <span class="sr-only">(current)</span></a>
									</li>
									<li class="page-item"><a class="page-link" href="#">3</a></li>
									<li class="page-item">
										<a class="page-link" href="#" aria-label="Next">
											<span aria-hidden="true">〉</span>
											<span class="sr-only">Next</span>
										</a>
									</li>
									<li class="page-item">
										<a class="page-link" href="#" aria-label="Next">
											<span aria-hidden="true">》</span>
											<span class="sr-only">last-page</span>
										</a>
									</li>
								</ul>
							</nav-->
							<!-- 페이지버튼 e-->
						</div>
					</div>
                </div>
				<!-- 기관관리 table e -->
            </div>
            <!-- main content area end -->
        </div>
    </div>
    <!-- footer area start-->
    <footer>
        <div class="footer-area">
            <p>© Copyright 2018 . All right reserved</p>
        </div>
    </footer>
    <!-- footer area end-->
    </div>
    <!-- page container area end -->
	
	
	<!-- 중간관리자 팝업 s-->
	<div class="modal fade amd_log_popup show">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header mt-4">
					<div class="modal-container w-100">
						<ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home"
									aria-selected="true" style="padding: 5px 20px;">실험 결과</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile"
									aria-selected="false" style="padding: 5px 20px;">분석 결과</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact"
									aria-selected="false" style="padding: 5px 20px;">결과 레포트</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="modal-body">
					<div class="tab-content" id="pills-tabContent">
						<!-- 실험결과 s -->
						<div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
							<div class="table-responsive">
								<h5 class="title">샘플정보</h5>
								<table class="table table-hover progress-table text-center">
									<tbody>
										<tr class="bg-dark text-white">
											<th>GC S ID</th>
											<th>실험 ID</th>
											<th>생년월일</th>
										</tr>
										<tr>
											<td>GC1809P1013</td>
											<td>GC1809P1013_V1</td>
											<td>--</td>
										</tr>
										<tr class="bg-dark text-white">
											<th>RSA</th>
											<th>RIF</th>
											<th>Translocation</th>
										</tr>
										<tr>
											<td>무</td>
											<td>무</td>
											<td>-</td>
										</tr>
										<tr class="bg-dark text-white">
											<th colspan="3">기타소견</th>
										</tr>
										<tr>
											<td colspan="3">-</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="table-responsive">
								<h5 class="title">실험결과</h5>
								<table class="table table-hover progress-table text-center">
									<tbody>
										<tr class="bg-dark text-white">
											<th>실험ID</th>
											<th>Bases</th>
											<th>>=Q20 Bases</th>
											<th>Reads</th>
											<th>MeanReadLength</th>
											<th>Histogram</th>
										</tr>
										<tr>
											<td></td>
											<td>1,066,838</td>
											<td>784,717</td>
											<td>12,787</td>
											<td>83bp</td>
											<td></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<!-- 실험결과 e -->
						<!-- 분석결과 s -->
						<div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
							<div class="table-responsive">
								<h5 class="title">샘플정보</h5>
								<table class="table table-hover progress-table text-center">
									<tbody>
										<tr class="bg-dark text-white">
											<th>GC S ID</th>
											<th>실험 ID</th>
											<th>생년월일</th>
										</tr>
										<tr>
											<td>GC1809P1013</td>
											<td>GC1809P1013_V1</td>
											<td>--</td>
										</tr>
										<tr class="bg-dark text-white">
											<th>RSA</th>
											<th>RIF</th>
											<th>Translocation</th>
										</tr>
										<tr>
											<td>무</td>
											<td>무</td>
											<td>-</td>
										</tr>
										<tr class="bg-dark text-white">
											<th colspan="3">기타소견</th>
										</tr>
										<tr>
											<td colspan="3">-</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="table-responsive">
								<h5 class="title">분석결과</h5>
								<table class="table table-hover progress-table text-center">
									<tbody>
										<tr class="bg-dark text-white">
											<th>실험ID</th>
											<th>Ver.</th>
											<th>Conf.</th>
											<th>MAPD</th>
											<th>MA</th>
											<th>An+</th>
											<th>An-</th>
											<th>Segment</th>
											<th>Proband</th>
										</tr>
										<tr>
											<td colspan="9">분석된 데이터가 없습니다.</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<!-- 분석결과 e -->
						<!-- 결과레포트 s -->
						<div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
							<div class="table-responsive">
								<h5 class="title">샘플정보</h5>
								<table class="table table-hover progress-table text-center">
									<tbody>
										<tr class="bg-dark text-white">
											<th>GC S ID</th>
											<th>생년월일/만나이</th>
										</tr>
										<tr>
											<td>GC1809P1013</td>
											<td>1980-06-24 (38)</td>
										</tr>
										<tr class="bg-dark text-white">
											<th>RSA</th>
											<th>RIF</th>
										</tr>
										<tr>
											<td>무</td>
											<td>무</td>
										</tr>
										<tr class="bg-dark text-white">
											<th>Translocation</th>
											<th>기타소견</th>
										</tr>
										<tr>
											<td>-</td>
											<td>1st baby : Down synd.</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="table-responsive">
								<h5 class="title">판정 결과</h5>
								<p class="non_txt text-center mb-3">-</p>
							</div>
							<div class="table-responsive">
								<div class="pricing hover-effect">
									<div class="pricing-head">
										<h5>레포트</h5>
									</div>
									<div class="pricing-content list-unstyled">
										<div class="list-group-item list-group-item-action flex-column align-items-start col-md-6">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">접수번호</p>
											  <p class="text-muted">GC1809P1007</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start col-md-6">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">식별코드</p>
											  <p class="text-muted">21804829</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start col-md-6">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">샘플코드</p>
											  <p class="text-muted">B5</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">의료기관명</p>
											  <p class="text-muted">강남 미즈메디 병원</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">진료과</p>
											  <p class="text-muted">GYN</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">담당의사명</p>
											  <p class="text-muted">홍길동</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">검사 대상자명</p>
											  <p class="text-muted">Zorany**</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">생년월일/만나이</p>
											  <p class="text-muted">1980-06-24 / 38</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">검체종류</p>
											  <p class="text-muted">Trophectoderm</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">검체체취일</p>
											  <p class="text-muted">2018-09-05</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">검체접수일</p>
											  <p class="text-muted">2018-09-05/11:30:00</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">검사의뢰일</p>
											  <p class="text-muted">2018-09-05</p>
											</div>
										</div>
										<div class="list-group-item list-group-item-action flex-column align-items-start">
											<div class="d-flex w-100 justify-content-between">
											  <p class="mb-1 font-weight-bold">결과보고일</p>
											  <p class="text-muted">-</p>
											</div>
										</div>
									</div>
									<div class="modal-footer">
										<a href="javascript:void(0)" class="btn btn-danger">반려</a>
										<a href="javascript:void(0)" class="btn btn-success">승인</a>
									</div>
								</div>
							</div>
						</div>
						<!-- 결과레포트 e -->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">확인</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 중간관리자 팝업 e-->
    
    <script>    
        const _ = new _Component($("#component"),"component");
        _.import(
            new _Component.ImportConf("restApi",true),
            new _Component.ImportConf("util/pug",false),
            new _Component.ImportConf("template",false),
            new _Component.ImportConf("pagination",true),
            new _Component.ImportConf("view",true),
            new _Component.ImportConf("util/popup",false),
            new _Component.ImportConf("util/menu",true),
            new _Component.ImportConf("util/topNavigation",true),
            new _Component.ImportConf("util/dateInfo",false),
            new _Component.ImportConf("__init__",true),
        )
        .then(
            function(selfComponent){
                const Popup = selfComponent.module.Popup;
                const restApi = selfComponent.module.restApi;
                const view = selfComponent.module.view;
                const pagination = selfComponent.module.pagination;
                const topNavi = selfComponent.module.topNavigation;
                const menu = selfComponent.module.menu;
                const pug = selfComponent.module.Pug;
                const dateInfo = selfComponent.module.DateInfo.instance;
                const userData = selfComponent.module.__init__.authData;

                const templateStorage  = {};
                const resultPopup = new Popup("/view/popup/result-check",$("#result-check-popup"));
                const histogramPopup = new Popup("/view/popup/histogram",$("#histogram-popup"));
                resultPopup.init(function($form,e){
                    $form.find("[name=\"__tab\"]").remove();
                    const formData = new FormData($form.get(0));
                    formData.set('search[idx]',this.__data.idx);
                    if(confirm('승인하시겠습니까?')){
                        restApi
                           .setExtra("POST",API_ROOT+"/experiment/approval.php",formData,"json")
                           .send()
                           .then(
                               function(e){
                                    view.request();
                               },
                               function(e){
                               }
                            );
                    }
                });
                histogramPopup.init(function(){});
                resultPopup.trigger(
                    new _Component.TriggerConf("input","[data-action=\"fake-submit\"]",function(e){
                        resultPopup.$form.submit();
                    }),
                    new _Component.TriggerConf("click","[data-action='toggle-histogram'][data-image]",function(e){
                        const imageData = $(this).data('image');
                        histogramPopup.open({
                            image : imageData
                        })
                        .then(
                            function(e){
                                histogramPopup.$zone.css('display', 'flex').addClass('is-active');
                            }
                        );
                    })
                )
                view.init($("#view"),"judgement","/view/result-info")
                    .addEventListener(
                        "beforeRequest",
                        (refSelf,requestConf)=>{
                            return {
                                page : undefined,
                                limit : undefined,
                                search : {
                                    status : 12,
                                    page : pagination.page,
                                    limit : 15,//view.limit,
                                }
                            } 
                        }
                    )
                    .request({__userData : userData})
                    .then(
                        ()=>{
                            view.trigger(
                                new _Component.TriggerConf("click","[data-action='approval']",function(e){
                                    const $this = $(this);
                                    let index = $(this).data('index');
                                    resultPopup.open(
                                        Object.assign(
                                            {
                                                __userData : userData,
                                            },  
                                            view.__data.data[index]
                                        )
                                    )
                                    .then(
                                        function(e){
                                            resultPopup.$zone.css('display', 'flex').addClass('is-active');
                                        }
                                    )
                                })
                            );
                            selfComponent.trigger(
                                new _Component.TriggerConf("click", "[data-action='refresh']",function(){
                                    view.request();
                                })
                            )
                        }
                    )
            }, 
            function(){

            }
        )
    </script>
	
    <?php
		include $_SERVER["DOCUMENT_ROOT"].'/include/footer_js.php';
	?>